	<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Archivio Film</title>
  <!-- jQuery + DataTables + DataTables Responsive + FixedHeader -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css">
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
  <!-- PapaParse -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <style>
    /* -----------------------
       LIGHT MODE (valori di base)
       ----------------------- */
    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      margin: 20px;
      background: #f4f6f9;
      color: #333;
      transition: all 0.25s ease;
    }

    h1 {
      text-align: center;
      margin-bottom: 15px;
      color: #222;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 15px;
      margin-bottom: 15px;
    }

    .filters label {
      display: flex;
      flex-direction: column;
      font-weight: 600;
      font-size: 14px;
      color: inherit;
    }

    .filters select,
    .filters input {
      margin-top: 5px;
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      min-width: 120px;
      background: #fff;
      color: #000;
      transition: all 0.25s ease;
    }

    #darkToggle {
      display: block;
      margin: 0 auto 15px auto;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: #0078d7;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    #darkToggle:hover { background: #005a9e; }

    table.dataTable {
      border-collapse: collapse;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: all 0.25s ease;
    }

    /* Intestazione sempre blu (richiesta) */
    table.dataTable thead th {
      background: #0078d7 !important;
      color: #fff;
      font-weight: 600;
      text-align: center;
    }

    /* Light mode: righe alternate chiare */
    table.dataTable tbody tr:nth-child(even) { background: #f9fbfd; }
    table.dataTable tbody tr:nth-child(odd)  { background: #ffffff; }
    table.dataTable tbody tr:hover { background: #eaf3ff; color: inherit; }

    /* Nascondi il box di ricerca standard (ma la ricerca resta attiva) */
    div.dataTables_filter { display: none !important; }

    /* Bottone flottante "torna su" */
    #backToTop {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #0078d7;
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      display: none;
      z-index: 1000;
    }
    #backToTop:hover { background: #005a9e; }

    /* Responsive tweaks */
    @media(max-width: 600px) {
      .filters { flex-direction: column; align-items: stretch; }
      .filters label { width: 100%; }
    }

    /* -----------------------
       DARK MODE (sovrascritture)
       ----------------------- */
    body.dark {
      background: #121212;
      color: #eee;
    }

    body.dark h1 { color: #f1f1f1; }

    body.dark .filters select,
    body.dark .filters input {
      background: #1e1e1e;
      color: #eee;
      border: 1px solid #555;
    }

    body.dark table.dataTable {
      background: #1e1e1e;
      color: #eee;
      box-shadow: 0 2px 8px rgba(255,255,255,0.03);
    }

    /* Righe alternate in dark mode: grigio pi√π chiaro per le righe pari */
    body.dark table.dataTable tbody tr:nth-child(even) { background: #2f2f2f; } /* pi√π chiaro */
    body.dark table.dataTable tbody tr:nth-child(odd)  { background: #1e1e1e; }
    body.dark table.dataTable tbody tr:hover { background: #3a3a3a; }

    /* L'header resta blu anche in dark grazie all'important sopra */
  </style>
</head>
<body class="dark"> <!-- dark mode di default -->
  <h1>üìÇ Archivio Film</h1>

  <!-- il pulsante di switch rimane disponibile -->
  <button id="darkToggle" type="button">‚òÄÔ∏è Disattiva Dark Mode</button>

  <div class="filters">
    <label>
      Path
      <select id="filterPath"><option value="">(Tutti)</option></select>
    </label>
    <label>
      Anno
      <select id="filterYear"><option value="">(Tutti)</option></select>
    </label>
    <label>
      Nome
      <input type="text" id="filterName" placeholder="find name...">
    </label>
  </div>

  <table id="filmTable" class="display nowrap" style="width:100%">
    <thead>
      <tr>
        <th>Path</th>
        <th>Name</th>
        <th>Year</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Bottone flottante -->
  <button id="backToTop" type="button">‚Üë</button>

  <script>
    let table;

    // Inizializza il testo del pulsante in base allo stato corrente
    const darkToggle = document.getElementById("darkToggle");
    function updateDarkToggleText() {
      darkToggle.textContent = document.body.classList.contains("dark")
        ? "‚òÄÔ∏è Disattiva Dark Mode"
        : "üåô Attiva Dark Mode";
    }
    updateDarkToggleText();

    // Toggle dark mode
    darkToggle.addEventListener("click", function() {
      document.body.classList.toggle("dark");
      updateDarkToggleText();
    });

    // Carica CSV e costruisci la tabella
    Papa.parse("list.csv", {
      download: true,
      header: true,
      complete: function(results) {
        const data = results.data;
        const tbody = document.querySelector("#filmTable tbody");

        data.forEach(row => {
          if (row.path) {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${row.path}</td>
              <td>${row.name}</td>
              <td>${row.year}</td>
              <td>${row.time}</td>
            `;
            tbody.appendChild(tr);
          }
        });

        // DataTables con ricerca attiva (ma box nascosto via CSS)
        table = new DataTable("#filmTable", {
          paging: false,
          lengthChange: false,
          info: false,
          searching: true,  // ricerca attiva per far funzionare il filtro "Nome"
          ordering: true,
          responsive: true,
          fixedHeader: true
        });

        const paths = [...new Set(data.map(r => r.path).filter(Boolean))].sort();
        const years = [...new Set(data.map(r => r.year).filter(Boolean))].sort();

        const filterPath = document.getElementById("filterPath");
        paths.forEach(p => filterPath.appendChild(new Option(p, p)));

        const filterYear = document.getElementById("filterYear");
        years.forEach(y => filterYear.appendChild(new Option(y, y)));

        document.getElementById("filterPath").addEventListener("change", function() {
          table.column(0).search(this.value).draw();
        });
        document.getElementById("filterYear").addEventListener("change", function() {
          table.column(2).search(this.value).draw();
        });
        document.getElementById("filterName").addEventListener("keyup", function() {
          table.column(1).search(this.value).draw();
        });
      }
    });

    // Bottone "torna su"
    const backToTop = document.getElementById("backToTop");
    window.addEventListener("scroll", () => {
      backToTop.style.display = window.scrollY > 300 ? "block" : "none";
    });
    backToTop.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: "smooth" });
    });
  </script>
</body>
</html>
